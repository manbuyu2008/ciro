(function(d){function c(n,l){if(!l){l=d.data(n,"datetimebox")}var k=l.options;var g=d(n);g.datebox(d.extend({},k,{onShowPanel:function(){var q=d(this).datetimebox("getValue");var p=d.data(n,"datetimebox");var o=p.options;e(this,q,true,p);o.onShowPanel.call(this)},formatter:d.fn.datebox.defaults.formatter,parser:d.fn.datebox.defaults.parser}));g.removeClass("datebox-f").addClass("datetimebox-f");g.combo("panel");g.datebox("calendar").calendar({onSelect:function(o){var r=d("#"+d(this).attr("comboid"))[0];var q=d.data(r,"datetimebox");var p=q.options;p.onSelect.call(r,o)}});var h=g.datebox("panel");if(!l.spinner){var m=d('<div style="padding:2px"><input style="width:80px"></div>').insertAfter(h.children("div.datebox-calendar-inner"));l.spinner=m.children("input");var j=h.children("div.datebox-button");var i=d('<a href="javascript:void(0)" class="datebox-ok"></a>').html(k.okText).appendTo(j);i.hover(function(){d(this).addClass("datebox-button-hover")},function(){d(this).removeClass("datebox-button-hover")}).bind("click",{target:n},function(o){a(o.data.target)})}l.spinner.timespinner({showSeconds:k.showSeconds,separator:k.timeSeparator}).unbind(".datetimebox").bind("mousedown.datetimebox",function(o){o.stopPropagation()});e(n,k.value,l)}function b(j){var g=d(j);var k=g.datetimebox("calendar");var i=g.datetimebox("spinner");var h=k.calendar("options").current;return new Date(h.getFullYear(),h.getMonth(),h.getDate(),i.timespinner("getHours"),i.timespinner("getMinutes"),i.timespinner("getSeconds"))}function f(h,g){e(h,g,true)}function a(j){var i=d.data(j,"datetimebox");var h=i.options;var g=b(j);e(j,h.formatter.call(j,g),undefined,i);d(j).combo("hidePanel")}function e(n,m,k,l){if(!l){l=d.data(n,"datetimebox")}var j=l.options;var i,g=d(n);g.combo("setValue",m);if(!k){if(m){i=j.parser.call(n,m);g.combo("setValueText",{value:j.formatter.call(n,i),text:j.formatter.call(n,i)})}else{g.combo("setText",m)}}i=j.parser.call(n,m);g.datetimebox("calendar").calendar("moveTo",i);g.datetimebox("spinner").timespinner("setValue",h(i,g.datetimebox("spinner").timespinner("options").separator));function h(p,r){function o(s){return(s<10?"0":"")+s}var q=[o(p.getHours()),o(p.getMinutes())];if(j.showSeconds){q.push(o(p.getSeconds()))}return q.join(r)}}d.fn.datetimebox=function(g,h){if(typeof g=="string"){var i=d.fn.datetimebox.methods[g];if(i){return i(this,h)}else{return this.datebox(g,h)}}g=g||{};return this.each(function(j){var k=d.data(this,"datetimebox");if(k){d.extend(k.options,j)}else{k=d.data(this,"datetimebox",{options:d.extend({},d.fn.datetimebox.defaults,d.fn.datetimebox.parseOptions(this),j)})}c(this,k)},[g])};d.fn.datetimebox.methods={options:function(g){return d.data(g[0],"datetimebox").options},spinner:function(g){return d.data(g[0],"datetimebox").spinner},setValue:function(h,g){return h.each(function(){e(this,g)})}};d.fn.datetimebox.parseOptions=function(h){var g=d(h);return d.extend({},d.fn.datebox.parseOptions(h),d.parser.parseOptions(h,["timeSeparator",{showSeconds:"boolean"}]))};d.fn.datetimebox.defaults=d.extend({},d.fn.datebox.defaults,{showSeconds:true,timeSeparator:":",keyHandler:{up:function(){},down:function(){},enter:function(){a(this)},query:function(g){f(this,g)}},formatter:function(i){var k=i.getHours();var n=i.getMinutes();var j=i.getSeconds();function g(h){return(h<10?"0":"")+h}var m=d(this).datetimebox("spinner").timespinner("options").separator;var l=d.fn.datebox.defaults.formatter(i)+" "+g(k)+m+g(n);if(d(this).datetimebox("options").showSeconds){l+=m+g(j)}return l},parser:function(j){if(d.trim(j)==""){return new Date()}var k=j.split(" ");var n=d.fn.datebox.defaults.parser(k[0]);if(k.length<2){return n}var l=d(this).datetimebox("spinner").timespinner("options").separator;var i=k[1].split(l);var g=parseInt(i[0],10)||0;var m=parseInt(i[1],10)||0;var h=parseInt(i[2],10)||0;return new Date(n.getFullYear(),n.getMonth(),n.getDate(),g,m,h)}})})(jQuery);