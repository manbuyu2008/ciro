(function(b){function c(e){var d=b.data(e,"propertygrid").options;b(e).datagrid(b.extend({},d,{cls:"propertygrid",view:(d.showGroup?a:undefined),onClickRow:function(h,i){if(d.editIndex!=h){var g=b(this).datagrid("getColumnOption","value");g.editor=i.editor;f(d.editIndex);b(this).datagrid("beginEdit",h);b(this).datagrid("getEditors",h)[0].target.focus();d.editIndex=h}d.onClickRow.call(e,h,i)},onLoadSuccess:function(g){b(e).datagrid("getPanel").find("div.datagrid-group").css("border","0");d.onLoadSuccess.call(e,g)}}));b(e).datagrid("getPanel").panel("panel").addClass("propertygrid");b(e).datagrid("getPanel").find("div.datagrid-body").unbind(".propertygrid").bind("mousedown.propertygrid",function(g){g.stopPropagation()});b(document).unbind(".propertygrid").bind("mousedown.propertygrid",function(){f(d.editIndex);d.editIndex=undefined});function f(g){if(g==undefined){return}var h=b(e);h.datagrid("getEditors",g)[0].target.blur();if(h.datagrid("validateRow",g)){h.datagrid("endEdit",g)}else{h.datagrid("cancelEdit",g)}}}b.fn.propertygrid=function(d,e){if(typeof d=="string"){var f=b.fn.propertygrid.methods[d];if(f){return f(this,e)}else{return this.datagrid(d,e)}}d=d||{};return this.each(function(){var g=b.data(this,"propertygrid");if(g){b.extend(g.options,d)}else{b.data(this,"propertygrid",{options:b.extend({},b.fn.propertygrid.defaults,b.fn.propertygrid.parseOptions(this),d)})}c(this)})};b.fn.propertygrid.methods={};b.fn.propertygrid.parseOptions=function(d){return b.extend({},b.fn.datagrid.parseOptions(d),b.parser.parseOptions(d,[{showGroup:"boolean"}]))};var a=b.extend({},b.fn.datagrid.defaults.view,{render:function(q,h,d){var g=b.data(q,"datagrid");var e=g.options;var v=g.data.rows;var o=b(q).datagrid("getColumnFields",d);var t=[];var p=0;var k=this.groups;for(var n=0;n<k.length;n++){var r=k[n];t.push('<div class="datagrid-group" group-index='+n+' style="height:25px;overflow:hidden;border-bottom:1px solid #ccc;">');t.push('<table cellspacing="0" cellpadding="0" border="0" style="height:100%"><tbody>');t.push("<tr>");t.push('<td style="border:0;">');if(!d){t.push('<span style="color:#666;font-weight:bold;">');t.push(e.groupFormatter.call(q,r.fvalue,r.rows));t.push("</span>")}t.push("</td>");t.push("</tr>");t.push("</tbody></table>");t.push("</div>");t.push('<table class="datagrid-btable" cellspacing="0" cellpadding="0" border="0"><tbody>');for(var m=0;m<r.rows.length;m++){var s=(p%2&&e.striped)?'class="datagrid-row datagrid-row-alt"':'class="datagrid-row"';var u=e.rowStyler?e.rowStyler.call(q,p,r.rows[m]):"";var f=u?'style="'+u+'"':"";var l=g.rowIdPrefix+"-"+(d?1:2)+"-"+p;t.push('<tr id="'+l+'" datagrid-row-index="'+p+'" '+s+" "+f+">");t.push(this.renderRow.call(this,q,o,d,p,r.rows[m]));t.push("</tr>");p++}t.push("</tbody></table>")}b(h).html(t.join(""))},onAfterRender:function(j){var h=b.data(j,"datagrid").options;var g=b.data(j,"datagrid").dc;var f=g.view;var e=g.view1;var d=g.view2;b.fn.datagrid.defaults.view.onAfterRender.call(this,j);var i;if(h.rownumbers||h.frozenColumns.length){i=e.find("div.datagrid-group")}else{i=d.find("div.datagrid-group")}b('<td style="border:0"><div class="datagrid-row-expander datagrid-row-collapse" style="width:25px;height:16px;cursor:pointer"></div></td>').insertBefore(i.find("td"));f.find("div.datagrid-group").each(function(){var k=b(this).attr("group-index");b(this).find("div.datagrid-row-expander").bind("click",{groupIndex:k},function(l){if(b(this).hasClass("datagrid-row-collapse")){b(j).datagrid("collapseGroup",l.data.groupIndex)}else{b(j).datagrid("expandGroup",l.data.groupIndex)}})})},onBeforeRender:function(m,p){var d=b.data(m,"datagrid").options;var e=[];var h,l;for(h=0,l=p.length;h<l;h++){var o=p[h];var n=g(o[d.groupField]);if(!n){n={fvalue:o[d.groupField],rows:[o],startRow:h};e.push(n)}else{n.rows.push(o)}}function g(q){for(var j=0;j<e.length;j++){var r=e[j];if(r.fvalue==q){return r}}return null}this.groups=e;var k=[];for(h=0,l=e.length;h<l;h++){n=e[h];for(var f=0;f<n.rows.length;f++){k.push(n.rows[f])}}b.data(m,"datagrid").data.rows=k}});b.extend(b.fn.datagrid.methods,{expandGroup:function(e,d){return e.each(function(){var f=b.data(this,"datagrid").dc.view;var g;if(d!=undefined){g=f.find('div.datagrid-group[group-index="'+d+'"]')}else{g=f.find("div.datagrid-group")}var h=g.find("div.datagrid-row-expander");if(h.hasClass("datagrid-row-expand")){h.removeClass("datagrid-row-expand").addClass("datagrid-row-collapse");g.next("table").show()}b(this).datagrid("fixRowHeight")})},collapseGroup:function(e,d){return e.each(function(){var f=b.data(this,"datagrid").dc.view;var g;if(d!=undefined){g=f.find('div.datagrid-group[group-index="'+d+'"]')}else{g=f.find("div.datagrid-group")}var h=g.find("div.datagrid-row-expander");if(h.hasClass("datagrid-row-collapse")){h.removeClass("datagrid-row-collapse").addClass("datagrid-row-expand");g.next("table").hide()}b(this).datagrid("fixRowHeight")})}});b.fn.propertygrid.defaults=b.extend({},b.fn.datagrid.defaults,{singleSelect:true,remoteSort:false,fitColumns:true,loadMsg:"",frozenColumns:[[{field:"f",width:16,resizable:false}]],columns:[[{field:"name",title:"Name",width:100,sortable:true},{field:"value",title:"Value",width:100,resizable:false}]],showGroup:false,groupField:"group",groupFormatter:function(d,e){return d}})})(jQuery);