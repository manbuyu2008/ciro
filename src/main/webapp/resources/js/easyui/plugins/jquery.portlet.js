(function($){function i(m,n){var l=$.data(m,"portlet").options;if(n){if(n.width){l.width=n.width}if(n.height){l.height=n.height}if(n.left!=null){l.left=n.left}if(n.top!=null){l.top=n.top}}$(m).panel("resize",l)}function a(m,n){var l=$.data(m,"portlet");if(n){if(n.left!=null){l.options.left=n.left}if(n.top!=null){l.options.top=n.top}}$(m).panel("move",l.options);if(l.shadow){l.shadow.css({left:l.options.left,top:l.options.top})}}function h(r){var l=$.data(r,"portlet"),o=$(r);var u=l.options;if(!o.attr("id")){o.attr("id",$.parser.getObjGUID())}if(l.options.portalId){o.attr("portalId",l.options.portalId)}if(!u.frameCreated){$('<iframe style="width:100%;height:100%;" scrolling="'+u.framescrolling+'" frameborder="'+u.frameborder+'"></iframe>').appendTo(o).attr("src",u.url);u.frameCreated=true}var p=l.options.tools||[];var n=o.attr("id");if(l.options.refresh){p.push({iconCls:"panel-tool-reload",handler:function(){var w=$("#"+n+">iframe");var v=w.attr("src");w.attr("src","").attr("src",v)}})}if(u.moreurl&&u.moreurl!=""){p.push({iconCls:"panel-tool-more",handler:function(){var w=$("#"+n)[0];var v=$.data(w,"portlet").options;var x=v.title;if(v.moretitle){x=v.moretitle}v.openMoreUrl.call(w,x,v.moreurl)}})}var q=$(r).panel($.extend({},l.options,{border:false,doSize:true,closed:true,cls:"portlet",headerCls:"portlet-header",bodyCls:"portlet-body",tools:p,boundOffset:6,closable:l.options.closable&&!l.options.readonly,onBeforeDestroy:function(){var w=this;var v=$.data(w,"portlet");if(v.options.onBeforeDestroy.call(w)==false){return false}if(v.shadow){v.shadow.remove()}},onClose:function(){var w=this;var v=$.data(w,"portlet");v.options.onClose.call(w);$(this).portlet("destroy")},onOpen:function(){var w=this;var v=$.data(w,"portlet");if(v.shadow){v.shadow.css({display:"block",zIndex:$.fn.portlet.defaults.zIndex++,left:v.options.left,top:v.options.top,width:v.portlet.outerWidth(),height:v.portlet.outerHeight()})}v.portlet.css("z-index",$.fn.portlet.defaults.zIndex++);v.options.onOpen.call(w)},onResize:function(w,v){var z=this;var y=$.data(z,"portlet");var x=$(z).panel("options");y.options.width=x.width;y.options.height=x.height;y.options.left=x.left;y.options.top=x.top;if(y.shadow){y.shadow.css({left:y.options.left,top:y.options.top,width:y.portlet.outerWidth(),height:y.portlet.outerHeight()})}y.options.onResize.call(z,w,v)},onMaximize:function(){var w=this;var v=$.data(w,"portlet");v.portlet.css("z-index",$.fn.portlet.defaults.zIndex++)}}));l.portlet=q.panel("panel");if(l.shadow){l.shadow.remove()}if(l.options.shadow==true){l.shadow=$('<div class="portlet-shadow"></div>').insertAfter(l.portlet);l.shadow.css({display:"none"})}var s;if(l.options.left==null){var m=l.options.width;if(isNaN(m)){m=l.portlet.outerWidth()}s=l.portlet.parent();l.options.left=(s.width()-m)/2+s.scrollLeft()}if(l.options.top==null){var t=l.portlet.height;if(isNaN(t)){t=l.portlet.outerHeight()}s=l.portlet.parent();l.options.top=(s.height()-t)/2+s.scrollTop()}a(r);if(l.options.closed==false){q.portlet("open")}c(r,l)}function f(m){var l=$.data(m,"portlet");l.portlet.draggable({handle:">div.panel-header>div.panel-title",disabled:l.options.readonly,proxy:function(){var o=$("#"+$(this).attr("targetid"))[0],n=$.data(o,"portlet");return n.proxy},onBeforeDrag:function(r){var n=$("#"+$(this).attr("targetid"));var q=n[0],p=$.data(q,"portlet");var s=b(q,p);var o=$(r.data.parent);s.left-=o.scrollLeft();s.top-=o.scrollTop();r.data.startLeft=s.left;r.data.startTop=s.top;r.data.left=s.left;r.data.top=s.top;r.data.width=s.width;r.data.height=s.height;r.data.lastLeft=p.options.bounds.left;r.data.lastTop=p.options.bounds.top;r.data.lastWidth=p.options.bounds.width;r.data.lastHeight=p.options.bounds.height;if(p.shadow){p.shadow.css("z-index",$.fn.portlet.defaults.zIndex++)}p.portlet.css("z-index",$.fn.portlet.defaults.zIndex++);if(!p.proxy){p.proxy=$('<div class="portlet-proxy"></div>').insertAfter(p.portlet)}p.proxy.css({display:"none",zIndex:$.fn.portlet.defaults.zIndex++,left:r.data.left,top:r.data.top});p.proxy._outerWidth(r.data.width);p.proxy._outerHeight(r.data.height);p.proxy.show()},onDrag:function(p){var o=$("#"+$(this).attr("targetid"))[0];var n=$.data(o,"portlet");j(o,n,p);n.proxy.css({display:"block",left:p.data.left,top:p.data.top,width:p.data.width,height:p.data.height});return false},onStopDrag:function(r){var n=$("#"+$(this).attr("targetid"));var q=n[0],p=$.data(q,"portlet");p.options.bounds.left=r.data.lastLeft;p.options.bounds.top=r.data.lastTop;p.options.bounds.width=r.data.lastWidth;p.options.bounds.height=r.data.lastHeight;var o=b(q,p);p.options.left=o.left+p.options.portalOptions.margine.left;p.options.top=o.top+p.options.portalOptions.margine.top;p.options.width=o.width-p.options.portalOptions.margine.left-p.options.portalOptions.margine.right;p.options.height=o.height-p.options.portalOptions.margine.top-p.options.portalOptions.margine.bottom;i(q);p.proxy=null}});l.portlet.resizable({disabled:l.options.readonly,onBeforeResize:function(q){var n=$("#"+$(this).attr("targetid"));var p=n[0],o=$.data(p,"portlet");var r=b(p,o);q.data.startLeft=r.left;q.data.startTop=r.top;q.data.left=r.left;q.data.top=r.top;q.data.width=r.width;q.data.height=r.height;if(o.shadow){o.shadow.css("z-index",$.fn.portlet.defaults.zIndex++)}o.portlet.css("z-index",$.fn.portlet.defaults.zIndex++);o.pmask=$('<div class="portlet-proxy-mask" style="width:100%;height:100%"></div>').insertAfter(o.portlet);o.pmask.css({zIndex:$.fn.portlet.defaults.zIndex++,left:0,top:0});if(!o.proxy){o.proxy=$('<div class="portlet-proxy"></div>').insertAfter(o.portlet)}o.proxy.css({display:"none",zIndex:$.fn.portlet.defaults.zIndex++,left:q.data.left,top:q.data.top});o.proxy._outerWidth(q.data.width);o.proxy._outerHeight(q.data.height);o.proxy.show()},onResize:function(q){var n=$("#"+$(this).attr("targetid"));var p=n[0],o=$.data(p,"portlet");k(p,o,q);o.proxy.css({left:q.data.left,top:q.data.top});o.proxy._outerWidth(q.data.width);o.proxy._outerHeight(q.data.height);return false},onStopResize:function(r){var n=$("#"+$(this).attr("targetid"));var q=n[0],p=$.data(q,"portlet");k(q,p,r);var o=d(q,r.data,p);p.options.bounds.left=o.left;p.options.bounds.top=o.top;p.options.bounds.width=o.width;p.options.bounds.height=o.height;p.options.left=r.data.left+p.options.portalOptions.margine.left;p.options.top=r.data.top+p.options.portalOptions.margine.top;p.options.width=r.data.width-p.options.portalOptions.margine.left-p.options.portalOptions.margine.right;p.options.height=r.data.height-p.options.portalOptions.margine.top-p.options.portalOptions.margine.bottom;i(q);p.pmask.remove();p.pmask=null;p.proxy.remove();p.proxy=null}})}function c(m,l){var n=b(m,l);l.options.left=n.left+l.options.portalOptions.margine.left;l.options.top=n.top+l.options.portalOptions.margine.top;l.options.width=n.width-l.options.portalOptions.margine.left-l.options.portalOptions.margine.right;l.options.height=n.height-l.options.portalOptions.margine.top-l.options.portalOptions.margine.bottom;i(m)}function k(s,o,u){var n=o.options.portalOptions;var x=n.gridColWidth,z=n.gridColCount*n.gridColWidth,p=n.gridRowHeight;var q=u.data.left,y=u.data.top,v=u.data.width,r=u.data.height;if(q<0){q=0}if(y<0){y=0}y=e(y,p);q=e(q,x);r=e(u.data.top+r,p)-y;if(r<1){r=1}v=e(u.data.left+v,x)-q;if(v<1){v=1}if(q+v>z){q=z-v}u.data.left=q;u.data.top=y;u.data.width=v;u.data.height=r;var m=d(s,u.data,o);if(o.options.onPortletResize){o.options.onPortletResize.call(s,s,{dir:u.data.dir,last:{left:u.data.lastLeft,top:u.data.lastTop,width:u.data.lastWidth,height:u.data.lastHeight},bounds:m,excludePortletIds:[$(s).attr("id")]})}m=g(s,m,o);u.data.left=m.left;u.data.top=m.top;u.data.width=m.width;u.data.height=m.height}function j(u,o,v){var n=o.options.portalOptions;var w=n.gridColWidth,y=n.gridColCount*n.gridColWidth,p=n.gridRowHeight;var r=v.data.left,x=v.data.top;if(r<0){r=0}if(x<0){x=0}x=e(x,p);var s=v.data.width;if(r+s>y){r=y-s}r=e(r,w);v.data.left=r;v.data.top=x;var m=d(u,v.data,o);m.width=o.options.bounds.width;m.height=o.options.bounds.height;var q={pageX:v.pageX,pageY:v.pageY,accept:true,bounds:m,lastBounds:{left:v.data.lastLeft,top:v.data.lastTop,width:v.data.lastWidth,height:v.data.lastHeight},excludePortletIds:[$(u).attr("id")]};if(o.options.onPortletDrag){o.options.onPortletDrag.call(u,u,q)}if(q.accept&&m.width>0&&m.height>0){v.data.lastLeft=m.left;v.data.lastTop=m.top;v.data.lastWidth=m.width;v.data.lastHeight=m.height}else{m={left:v.data.lastLeft,top:v.data.lastTop,width:v.data.lastWidth,height:v.data.lastHeight}}m=g(u,m,o);v.data.left=m.left;v.data.top=m.top;v.data.width=m.width;v.data.height=m.height}function e(m,l){var o=m%l;if(o<Math.floor(l/2)){m-=o}else{m+=l-o}return m}function d(n,l,m){return m.options.getCellBounds(l,m.options.portalOptions)}function b(m,l){if(!l){l=$.data(m,"portlet")}return g(m,l.options.bounds,l)}function g(o,m,n){if(!n){n=$.data(o,"portlet")}var l=n.options;return n.options.getActualBounds(m,l.portalOptions)}$.fn.portlet=function(l,m){if(typeof l=="string"){var n=$.fn.portlet.methods[l];if(n){return n(this,m)}else{return this.panel(l,m)}}l=l||{};return this.each(function(o){var p=$.data(this,"portlet");if(p){$.extend(p.options,o)}else{p=$.data(this,"portlet",{options:$.extend({},$.fn.portlet.defaults,$.fn.portlet.parseOptions(this),o)})}h(this);f(this)},[l])};$.fn.portlet.methods={options:function(l){return $.data(l[0],"portlet").options},portlet:function(l){return $.data(l[0],"portlet").portlet},resize:function(m,l){return m.each(function(){i(this,l)})},move:function(m,l){return m.each(function(){a(this,l)})},portletResize:function(o,n){var m=$.data(o[0],"portlet");var l=m.options;l=$.extend(l,n);c(o[0],m)},portalOptions:function(o,n){var m=$.data(o[0],"portlet");var l=m.options;if(!n){return l.portalOptions}else{l.portalOptions=$.extend(l.portalOptions||{},n);c(o[0],m)}},setReadOnly:function(m,l){m.portlet({readonly:l})}};$.fn.portlet.parseOptions=function(l){return $.extend({},$.fn.panel.parseOptions(l),$.parser.parseOptions(l,[{shadow:"boolean"}]))};$.fn.portlet.defaults=$.extend({},$.fn.panel.defaults,{zIndex:1000,shadow:true,refresh:true,readonly:false,bounds:{left:0,top:0,width:0,height:0},margine:{left:10,top:10,right:0,bottom:0},title:"New portlet",collapsible:false,minimizable:false,maximizable:false,showrefresh:true,showmore:true,closable:true,closed:false,framescrolling:"no",frameborder:0,openMoreUrl:function(m,l){}})})(jQuery);