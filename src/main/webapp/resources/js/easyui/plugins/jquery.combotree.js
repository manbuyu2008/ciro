(function(c){function h(n,m,l){if(!l){l=c.data(n,"combotree")}var k=l.options;if(!l.tree){c(n).combo("panel")}l.remainText=true;if(k.onQuery){k.onQuery.call(n,m)}l.remainText=false}function b(m,l,k){if(!k){k=c.data(m,"combotree")}k.remainText=true}function f(q,m){var p=c.data(q,"combotree");var o=p.options;var l=p.tree;var k=c(q);if(!l){l=c('<ul comboid="'+k.attr("id")+'"></ul>').appendTo(m);p.tree=l}l.tree(c.extend({},o,{checkbox:o.multiple,onLoadSuccess:function(w,y){var A=c("#"+c(this).attr("comboid"))[0];var s=c.data(A,"combotree");if(s.donotFired){return}var r=s.options;var v=c(A);var B=v.combotree("getValues");if(r.multiple){var t=s.tree.tree("getChecked");for(var x=0,z=t.length;x<z;x++){var u=t[x].id;if(indexOfArray(B,u)<0){B.push(u)}}}g(A,B,s.remainText,s);r.onLoadSuccess.call(this,w,y)},onClick:function(t){var v=c("#"+c(this).attr("comboid"))[0];var u=c.data(v,"combotree");if(u.donotFired){return}u.remainText=false;var s=u.options;if(s.onBeforeClick&&!s.onBeforeClick.call(v,t)){return}n(v);var r=c(v);if(!s.multiple){r.combo("hidePanel")}r.combo("textbox").focus().select();s.onClick.call(v,t)},onSelect:function(s){var u=c("#"+c(this).attr("comboid"))[0];var t=c.data(u,"combotree");if(t.donotFired){return}var r=t.options;n(u,t);r.onSelect.call(this,s)},onUnselect:function(s){var u=c("#"+c(this).attr("comboid"))[0];var t=c.data(u,"combotree");if(t.donotFired){return}var r=t.options;n(u,t);r.onUnselect.call(this,s)},onCheck:function(t,s){var v=c("#"+c(this).attr("comboid"))[0];var u=c.data(v,"combotree");if(u.donotFired){return}u.remainText=false;n(v,u);var r=u.options;r.onCheck.call(v,t,s)}}));function n(y,s){if(!s){s=c.data(y,"combotree")}var r=s.options;var B=s.tree;var u=c(y);var z=[],A=[];if(r.multiple){var t=B.tree("getChecked");for(var w=0,x=t.length;w<x;w++){z.push(t[w].id);A.push(t[w].text)}}else{var v=B.tree("getSelected");if(v){z.push(v.id);A.push(v.text)}}if(!s.remainText){u.combo("setText",A.join(r.separator)).combo("setValues",z)}}}function e(n,m){if(!m){m=c.data(n,"combotree")}var l=m.options;var k=c(n);k.addClass("combotree-f");if(!k.attr("id")){k.attr("id",c.parser.getObjGUID())}l.afterPanelInited=f;k.combo(l)}function g(q,w,o,l){if(!l){l=c.data(q,"combotree")}var k=l.options;var A=l.tree;var x=c(q);if(!A){if(x.combo("getValues").join(",")==w.join(",")){return}x.combo("setValues",w)}else{A.find("span.tree-checkbox").addClass("tree-checkbox0").removeClass("tree-checkbox1 tree-checkbox2");var r=[],z=[];l.donotFired=true;for(var n=0,p=w.length;n<p;n++){var u=w[n];var y=u;var m=A.tree("find",u);if(m){y=m.text;A.tree("check",m.target);A.tree("select",m.target)}r.push(u);z.push(y)}l.donotFired=false;if(!o){x.combo("setText",z.join(k.separator))}x.combo("setValues",r)}}function d(n,l,m){if(!m){m=c.data(n,"combotree")}if(!m.tree){c(n).combo("panel")}var k=m.tree;m.remainText=false;if(l<0){k.tree("selectPrev")}else{k.tree("selectNext")}}function j(m){var l=c.data(m,"combotree");var k=l.tree;if(k){return k}c(m).combo("panel");return l.tree}function a(n){var m=c.data(n,"combotree");var k=m.tree;if(!k){return k}var l=k.tree("getSelected");if(l){k.tree("expand",l.target)}}function i(n){var m=c.data(n,"combotree");var k=m.tree;if(!k){return k}var l=k.tree("getSelected");if(l){k.tree("collapse",l.target)}}c.fn.combotree=function(k,l){if(typeof k=="string"){var m=c.fn.combotree.methods[k];if(m){return m(this,l)}else{return this.combo(k,l)}}k=k||{};return this.each(function(n){var o=c.data(this,"combotree");if(o){c.extend(o.options,n)}else{o=c.data(this,"combotree",{options:c.extend({},c.fn.combotree.defaults,c.fn.combotree.parseOptions(this),n)})}e(this,o)},[k])};c.fn.combotree.methods={options:function(k){return c.data(k[0],"combotree").options},tree:function(k){return j(k[0])},loadData:function(l,k){return l.each(function(){var o=c.data(this,"combotree");var n=o.options;n.data=k;if(!o.tree){c(this).combo("panel")}var m=o.tree;m.tree("loadData",k)})},reload:function(l,k){return l.each(function(){var o=c.data(this,"combotree");var n=o.options;if(!o.tree){c(this).combo("panel")}var m=o.tree;if(k){n.url=k}m.tree({url:n.url})})},setValues:function(l,k){return l.each(function(){g(this,k)})},setValue:function(l,k){return l.each(function(){g(this,[k])})},clear:function(k){return k.each(function(){var o=c.data(this,"combotree");if(o.tree){c(this).combo("panel");var m=o.tree;m.find("div.tree-node-selected").removeClass("tree-node-selected");var p=m.tree("getChecked");for(var n=0,l=p.length;n<l;n++){m.tree("uncheck",p[n].target)}}c(this).combo("clear")})}};c.fn.combotree.parseOptions=function(k){return c.extend({},c.fn.combo.parseOptions(k),c.fn.tree.parseOptions(k))};c.fn.combotree.defaults=c.extend({},c.fn.combo.defaults,c.fn.tree.defaults,{editable:false,keyHandler:{up:function(){d(this,-1)},down:function(){d(this,1)},enter:function(){var m=c.data(this,"combotree");var l=m.options;var k=m.tree.tree("getSelected");l.onClick.call(this,k);c(this).combo("hidePanel")},ctrlLeft:function(){i(this)},ctrlRight:function(){a(this)}},doBeforeQuery:function(k){b(this,k)},doQuery:function(k){h(this,k)}})})(jQuery);