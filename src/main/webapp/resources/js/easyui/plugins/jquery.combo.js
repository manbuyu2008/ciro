(function($){function p(B,D){var C=B.css(D);if(C){if(C.endsWith("px")){C=C.substr(0,C.length-2)}}return"0"+C}function u(I,E,D){if(!D){D=$.data(I,"combo")}var C=D.options;var F=D.combo;if(E){C.width=E}F.appendTo("body");if(isNaN(C.width)){C.width=F.find("input.combo-text").outerWidth()}var J=C.width;if($.browser.msie){J+=C.eapborder}var G=0;if(C.hasDownArrow){G=F.find(".combo-arrow").outerWidth()}var H=F.find("input.combo-text");F.width(J);H.width(F.width()-G);if(H.width()>J){H.width(J-G)}var B=D.panel;if(B){i(B,D)}F.insertAfter(I)}function i(C,E){if(!E){E=$.data(target,"combo")}var D=E.options;var B=D.panelWidth?D.panelWidth:E.combo.outerWidth();if(D.columns&&B<250){B=250}C.panel("resize",{width:B,height:D.panelHeight})}function l(E,C){if(!C){C=$.data(E,"combo")}var B=C.options;var D=C.combo;if(B.hasDownArrow){D.find(".combo-arrow").show()}else{D.find(".combo-arrow").hide()}}function q(H,G){var C=$(H);var B=C.attr("tabIndex");C.addClass("combo-f").removeAttr("tabIndex").hide();if(!C.attr("id")){C.attr("id",$.parser.getObjGUID())}var F=$('<span class="combo"></span>').insertAfter(H);var D=$('<input type="text" class="combo-text">').appendTo(F);if(B){C.attr("tabIndex","");D.attr("tabIndex",B)}$('<span><span class="combo-arrow"></span></span><input type="hidden" class="combo-value">').appendTo(F);var E=C.attr("name");if(E){F.find("input.combo-value").attr("name",E);C.removeAttr("name").attr("comboName",E)}D.attr("autocomplete","off");return{combo:F,panel:G.afterPanelInited?undefined:v(H)}}function v(C){var B=$('<div class="combo-panel" targetid="'+$(C).attr("id")+'"></div>').appendTo("body");B.panel({doSize:false,closed:true,cls:"combo-p",style:{position:"absolute",zIndex:10},onOpen:function(){$(this).panel("resize")},onClose:function(){var E=$("#"+$(this).attr("targetid"))[0];var D=$.data(E,"combo");D.options.onHidePanel.call(E)}});return B}function h(E,D){var B=v(E);if(!D){D=$.data(E,"combo")}var C=D.options;D.panel=B;i(B,D);b(B,C.disabled);if(C.afterPanelInited){C.afterPanelInited(E,B)}return B}function b(B,C){B.unbind(".combo")}function x(D){var C=$.data(D,"combo");var B=C.combo.find("input.combo-text");B.validatebox("destroy");if(C.panel){C.panel.panel("destroy")}C.combo.remove();$(D).remove()}function d(H,F){if(!F){F=$.data(H,"combo")}var D=F.options;var G=F.combo;var C=G.find(".combo-text");var E=G.find(".combo-arrow");$(document).unbind(".combo").bind("mousedown.combo",function(K){var I=$("body>div.combo-p>div.combo-panel");var J=$(K.target).closest("div.combo-panel",I);if(J.length){return}I.panel("close")});G.unbind(".combo");var B=F.panel;if(B){b(B,D.disabled)}C.unbind(".combo");E.unbind(".combo");if(!D.disabled){C.bind("mousedown.combo",function(I){I.stopPropagation()}).bind("keydown.combo",{target:H},function(N){var M=N.data.target;var L=$.data(M,"combo");var K=L.options;var J=$(this);switch(N.keyCode){case 38:if(K.keyHandler.up){K.keyHandler.up.call(M,J.val())}break;case 40:if(!A(M,L)){var I=$(M).attr("id");setTimeout(function(){var P=$("#"+I)[0];var O=$.data(P,"combo");z(P,O);n(P,true,O)},0)}else{if(K.keyHandler.down){K.keyHandler.down.call(M,J.val())}}break;case 13:if(A(M,L)){N.preventDefault();if(K.keyHandler.enter){K.keyHandler.enter.call(M,J.val())}return false}case 9:case 27:e(M,L);break;case 37:if(N.ctrlKey&&K.keyHandler.ctrlLeft){K.keyHandler.ctrlLeft.call(M,J.val());return false}break;case 39:if(N.ctrlKey&&K.keyHandler.ctrlRight){K.keyHandler.ctrlRight.call(M,J.val());return false}break}}).bind("input.combo propertychange.combo",{target:H},function(N){var M=N.data.target;var L=$.data(M,"combo");var J=L.options;var K=$(this).val();if(L.isInput&&J.editable&&J.doQuery!=null&&L.previousValue!=K){if(a(M,L).length){f(M,"",L)}if(L.timer){clearTimeout(L.timer)}var I=$(M).attr("id");L.timer=setTimeout(function(){var R=$("#"+I)[0];var Q=$.data(R,"combo");var P=Q.options;var O=Q.combo.find("input.combo-text");if(Q.previousValue!=K){Q.previousValue=K;P.doBeforeQuery.call(R,K);z(R,Q,true);P.doQuery.call(R,K);n(R,true,Q)}},J.delay)}});E.bind("click.combo",{target:H},function(L){var K=L.data.target;var J=$.data(K,"combo");var I=$(this);if(!J.panel){B=h(K,J)}else{B=J.panel}if(B.is(":visible")){e(K,J)}else{$("div.combo-panel").panel("close");z(K,J)}I.focus()}).bind("mouseenter.combo",function(){$(this).addClass("combo-arrow-hover")}).bind("mouseleave.combo",function(){$(this).removeClass("combo-arrow-hover")}).bind("mousedown.combo",function(){return false})}}$(window).resize(function(){$(".combo-f").each(function(){e(this)})});function z(H,F,I){if(!F){F=$.data(H,"combo")}var D=F.options;var G=F.combo;var C=F.panel;if(!C){C=h(H,F)}if($.fn.window){C.panel("panel").css("z-index",$.fn.window.defaults.zIndex++)}if(!C.is(":visible")){C.panel("move",{left:-9999,top:0});C.panel("open");D.onShowPanel.call(H,I)}function B(){var L=G.offset().left;var J=document.body.clientWidth+$(document).scrollLeft();var K=C.outerWidth();if(L+K>J){L=J-K}if(L<0){L=0}return L}function E(){var O=G.offset().top,K=G.outerHeight(),L=document.body.clientHeight,J=$(document).scrollTop(),N=C.outerHeight();var M=O+K;if(M+N>L+J){M=O-N}if(M<J){M=O+K}return M}(function(){if(C.is(":visible")){C.panel("move",{left:B(),top:E()});setTimeout(arguments.callee,200)}})()}function e(D,C){if(!C){C=$.data(D,"combo")}var B=C.panel;if(!B){return}B.panel("close")}function A(D,C){if(!C){C=$.data(D,"combo")}var B=C.panel;return(B&&B.is(":visible"))}function n(E,F,D){if(!D){D=$.data(E,"combo")}var B=D.combo.find("input.combo-text");var C={};if($(B).data("validatebox")){C=$(B).data("validatebox").options;if(C.required==undefined){C.required=false}}B.validatebox($.extend(C,D.options));if(F){B.validatebox("validate");B.trigger("mouseleave")}}function k(F,B,D){if(!D){D=$.data(F,"combo")}var C=D.options;var E=D.combo;if(B){C.disabled=true;$(F).prop("disabled",true);E.find(".combo-value").prop("disabled",true);E.find(".combo-text").prop("disabled",true)}else{C.disabled=false;$(F).prop("disabled",false);E.find(".combo-value").prop("disabled",false);E.find(".combo-text").prop("disabled",false)}}function o(C,B){w(C,{value:"",text:""},B)}function c(D,B){if(!B){B=$.data(D,"combo")}var C=B.combo;return C.find("input.combo-text").val()}function s(D,E,B){if(!B){B=$.data(D,"combo")}var C=B.combo;B.isInput=false;C.find("input.combo-text").val(E);n(D,true,B);if(E){B.previousValue=E}else{B.previousValue=""}B.isInput=true}function a(D,B){if(!B){B=$.data(D,"combo")}var C=B.combo;return C.find("input.combo-value").val().split(",")}function r(G,C,E){if(!E){E=$.data(G,"combo")}var D=E.options;var B=a(G,E);var F=E.combo;F.find("input.combo-value").val(C.join(","));if(C.join(",")!=B.join(",")){if(D.multiple){D.onChange.call(G,C.join(","),B.join(","))}else{D.onChange.call(G,C[0],B[0])}}}function t(H,C,G){if(!G){G=$.data(H,"combo")}var D,B,F=[],E=[];for(D=0,B=C.length;D<B;D++){E.push(C[D].value);F.push(C[D].text)}s(H,F.join(","),G);r(H,E,G)}function w(G,H,C){if(!C){C=$.data(G,"combo")}var B=C.options;var D,F,I=[];if(B.multiple){var J=(H.value+"").split(",");F=J.length;if(F>1){var E=(H.text+"").split(",");for(D=0;D<F;D++){I.push({value:J[D],text:E[D]})}}else{I.push(H)}}else{I.push(H)}t(G,I,C)}function g(D,C){var B=a(D,C);return B[0]}function f(E,D,C){var B;if(D!=undefined){B=(D+"").split(",")}else{B=[D]}r(E,B,C)}function j(E,D){if(!D){D=$.data(E,"combo")}var C=D.options;var B=C.onChange;C.onChange=function(){};if(C.multiple){if(C.value){if(typeof C.value=="object"){r(E,C.value,D)}else{f(E,C.value,D)}}else{r(E,[],D)}}else{f(E,C.value,D)}C.onChange=B}function y(D){var C=$.data(D,"combo");var B=C.panel;if(B){return B}return h(D,C)}function m(D,C){var B=$.data(D,"combo");$(D).appendTo(C);B.combo.insertAfter(D)}$.fn.combo=function(B,C){if(typeof B=="string"){return $.fn.combo.methods[B](this,C)}B=B||{};return this.each(function(D){var G=$.data(this,"combo");var H=$(this);if(!D.width||D.width=="auto"){if(H.is(":visible")){D.width=H.width()}else{D.width=H.width()-D.eapborder}}if(G){$.extend(G.options,D);G.isInput=false}else{var F=$.extend({},$.fn.combo.defaults,$.fn.combo.parseOptions(this),D);var E=q(this,F);G=$.data(this,"combo",{options:F,combo:E.combo,panel:E.panel,previousValue:"",isInput:true});H.prop("disabled",false)}$("input.combo-text",G.combo).attr("readonly",!G.options.editable);l(this,G);k(this,G.options.disabled,G);u(this,undefined,G);d(this,G);n(this,false,G);j(this,G);G.isInput=true},[B])};$.fn.combo.methods={state:function(B){return $.data(B[0],"combo")},options:function(B){return $.data(B[0],"combo").options},panel:function(B){return y(B[0])},textbox:function(B){return $.data(B[0],"combo").combo.find("input.combo-text")},destroy:function(B){return B.each(function(){x(this)})},resize:function(C,B){return C.each(function(){u(this,B)})},showPanel:function(B){return B.each(function(){z(this)})},hidePanel:function(B){return B.each(function(){e(this)})},disable:function(B){return B.each(function(){k(this,true);d(this)})},enable:function(B){return B.each(function(){k(this,false);d(this)})},validate:function(B){return B.each(function(){n(this,true)})},isValid:function(C){var B=$.data(C[0],"combo").combo.find("input.combo-text");return B.validatebox("isValid")},clear:function(B){return B.each(function(){o(this)})},getText:function(B){return c(B[0])},setText:function(C,B){return C.each(function(){s(this,B)})},getValues:function(B){return a(B[0])},setValues:function(C,B){return C.each(function(){r(this,B)})},getValue:function(B){return g(B[0])},setValue:function(C,B){return C.each(function(){f(this,B)})},setValueText:function(C,B){return C.each(function(D){w(this,D)},[B])},setValueTexts:function(C,B){return C.each(function(D){t(this,D)},[B])},panelCreated:function(C){var B=$.data(C[0],"combo");return B.panel!=undefined},moveTo:function(C,B){return C.each(function(D){m(this,D)},[B])}};$.fn.combo.parseOptions=function(E){var C=$(E);var B=C.attr("class")+"";if(B.indexOf("easyui-")<0){return $.extend({},$.fn.validatebox.parseOptions(E),{width:(parseInt(E.style.width)||undefined),disabled:(C.prop("disabled")?true:undefined),value:(C.val()||undefined)})}var D=C.attr("panelHeight");return $.extend({},$.fn.validatebox.parseOptions(E),$.parser.parseOptions(E,["width","separator",{panelWidth:"number",editable:"boolean",hasDownArrow:"boolean",delay:"number"}]),{panelHeight:(D=="auto"?"auto":parseInt(D)||undefined),multiple:(C.attr("multiple")?true:undefined),disabled:(C.prop("disabled")?true:undefined),value:(C.val()||undefined)})};$.fn.combo.defaults=$.extend({},$.fn.validatebox.defaults,{width:"auto",panelWidth:null,panelHeight:200,multiple:false,separator:",",editable:true,disabled:false,hasDownArrow:true,value:"",delay:200,eapborder:6,keyHandler:{up:function(){},down:function(){},enter:function(){}},doBeforeQuery:function(B){},doQuery:undefined,onShowPanel:function(){},onHidePanel:function(){},onChange:function(C,B){}})})(jQuery);