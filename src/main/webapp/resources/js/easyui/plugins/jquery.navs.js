(function(d){function b(m){return d(m).data("navs")}function k(m,n){d(m).data("navs",n)}function l(m,o){var n=d(o.panelSelector);d(m).find("li").each(function(r){var q=j();var p=d(n).eq(r);d(p).attr("targetid",q);var s={id:q,title:d(this).children("a").text(),nav:d(this),panel:p,crumb:[{text:document.title},{text:"主页"}],closable:false};o.navs.push(s);d(this).attr("id",q)});k(m,o);c(o.navs[0]);e(m)}function j(){var p=["0","1","2","3","4","5","6","7","8","9","a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z"];var m="";for(var o=0;o<9;o++){var q=Math.ceil(Math.random()*35);m+=p[q]}return m}function i(m,p){var n=b(m);var o={};d(n.navs).each(function(q,r){if(r.title==p){o=r;return}});return o}function e(m){var n=b(m);d(n.navs).each(function(o){var p=this;d(p.nav).unbind("click").bind("click",function(){f(m,n.navs[o])}).bind("contextmenu",{container:m},function(s){var r=d(this);var q=s.data.container;n.onContextMenu.call(q,s,i(q,d(r).children("a").text()))}).unbind("dblclick").bind("dblclick",function(){var q={closeType:d.fn.navs.defaults.closeType.close,nav:i(m,p.title)};g(m,q)}).find("p > a").unbind("click").bind("click",function(){if(d(this).prop("class")=="refresh"){var q=p.panel.prop("src");p.panel.prop("src",q)}else{var r={closeType:d.fn.navs.defaults.closeType.close,nav:i(m,p.title)};g(m,r)}return false})})}function f(m,o){var n=b(m);d(n.navs).each(function(){if(this.id==o.id){this.nav.removeClass().addClass("selected");if(this.nav.children("p").size()==0){this.nav.children("a").after('<p><a class="refresh" href="#">刷新</a><a class="close" href="#">关闭</a></p>')}this.panel.show()}else{this.nav.removeClass().children("p").remove();this.panel.hide()}});e(m);c(o)}function c(o){var n="";if(!o.crumb){d.extend(o,{crumb:[]});o.crumb.push({text:document.title});o.crumb.push({text:o.title})}var m=o.crumb.length;d(o.crumb).each(function(p){if(!this.attributes){if(p<m-1){n+='<a href="#">'+this.text+"</a><span>&gt;</span>"}else{n+='<a href="#">'+this.text+"</a>"}}else{n+='<a href="#">'+this.text+"</a>"}});d(d.fn.navs.defaults.crumbSelector).html(n)}function h(n,p){var m=false;var o=b(n);d(o.navs).each(function(q,r){if(r.title==p){m=true;return}});return m}function a(n,s){if(!h(n,s.title)){var q=b(n);var p=j();d(n).find("li").eq(q.navs.length-1).after('<li id="'+p+'" class="selected"><a href="#">'+s.title+"</a></li>");var o=d(q.panelSelector);d(o).hide().eq(q.navs.length-1).after(s.panel);var m=d(q.panelSelector).eq(q.navs.length);m.attr("targetid",p);d.extend(s,{id:p,nav:d("#"+p),panel:m,closable:true});q.navs.push(s);k(n,q);f(n,s)}else{var r=i(n,s.title);f(n,r)}}function g(m,s){var q=b(m);switch(s.closeType){case d.fn.navs.defaults.closeType.close:d(q.navs).each(function(n){if(this.closable&&this==s.nav){this.nav.remove();this.panel.remove();q.navs.splice(n,1)}});break;case d.fn.navs.defaults.closeType.closeAll:for(var r=0;r<q.navs.length;r++){var o=q.navs[r];if(o.closable){o.nav.remove();o.panel.remove();q.navs.splice(r,1);r--}}break;case d.fn.navs.defaults.closeType.closeAllOther:for(var p=0;p<q.navs.length;p++){var t=q.navs[p];if(t.closable&&t!=s.nav){t.nav.remove();t.panel.remove();q.navs.splice(p,1);p--}}break}k(m,q);f(m,q.navs[q.navs.length-1])}d.fn.navs=function(n,o){if(typeof n=="string"){return d.fn.navs.methods[n](this,o)}var m=b(this);if(!m){m=d.extend(d.fn.navs.defaults,n);l(this,m)}};d.fn.navs.methods={add:function(n,m){return n.each(function(){a(this,m)})},close:function(n,m){return n.each(function(){g(this,m)})},getNavs:function(m){return b(m[0])}};d.fn.navs.defaults={navs:[],closeType:{close:"close",closeAll:"closeAll",closeAllOther:"closeAllOther"},onLoad:function(m){},onSelect:function(n,m){},onBeforeClose:function(n,m){},onClose:function(n,m){},onAdd:function(n,m){},onUpdate:function(n,m){},onContextMenu:function(m,n){},onSelectedNavResize:function(n,m){}}})(jQuery);