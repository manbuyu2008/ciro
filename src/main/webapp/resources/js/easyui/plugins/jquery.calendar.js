(function(e){function g(m,k){if(!k){k=e.data(m,"calendar")}var j=k.options;var i=e(m);if(j.fit==true){var l=i.parent();j.width=l.width();j.height=l.height()}var n=i.find(".calendar-header");i._outerWidth(j.width);i._outerHeight(j.height);i.find(".calendar-body")._outerHeight(i.height()-n.outerHeight())}function f(j){var i=e(j);i.addClass("calendar").wrapInner('<div class="calendar-header"><div class="calendar-prevmonth"></div><div class="calendar-nextmonth"></div><div class="calendar-prevyear"></div><div class="calendar-nextyear"></div><div class="calendar-title"><span>Aprial 2010</span></div></div><div class="calendar-body"><div class="calendar-menu"><div class="calendar-menu-year-inner"><span class="calendar-menu-prev"></span><span><input class="calendar-menu-year" type="text"/></span><span class="calendar-menu-next"></span></div><div class="calendar-menu-month-inner"></div></div></div>');i.find(".calendar-title span").hover(function(){e(this).addClass("calendar-menu-hover")},function(){e(this).removeClass("calendar-menu-hover")}).click(function(){var k=e(this);var l=k.find(".calendar-menu");if(l.is(":visible")){l.hide()}else{c(k.parents(".calendar")[0])}});e(".calendar-prevmonth,.calendar-nextmonth,.calendar-prevyear,.calendar-nextyear",j).hover(function(){e(this).addClass("calendar-nav-hover")},function(){e(this).removeClass("calendar-nav-hover")});i.find(".calendar-nextmonth").bind("click",{target:j},function(k){d(k.data.target,1)});i.find(".calendar-prevmonth").bind("click",{target:j},function(k){d(k.data.target,-1)});i.find(".calendar-nextyear").bind("click",{target:j},function(k){h(k.data.target,1)});i.find(".calendar-prevyear").bind("click",{target:j},function(k){h(k.data.target,-1)});i.bind("_resize",function(){var k=e.data(this,"calendar");var l=k.options;if(l.fit==true){g(this,k)}return false})}function d(k,m){var j=e.data(k,"calendar");var i=j.options;i.month+=m;if(i.month>12){i.year++;i.month=1}else{if(i.month<1){i.year--;i.month=12}}a(k,j);var l=e(k).find(".calendar-menu-month-inner");l.find("td.calendar-selected").removeClass("calendar-selected");l.find("td:eq("+(i.month-1)+")").addClass("calendar-selected")}function h(k,m){var j=e.data(k,"calendar");var i=j.options;i.year+=m;a(k,j);var l=e(k).find(".calendar-menu-year");l.val(i.year)}function c(r){var l=e.data(r,"calendar");var k=l.options,m=e(r);m.find(".calendar-menu").show();var s=m.find(".calendar-menu-month-inner");if(s.is(":empty")){s.empty();var y=e("<table></table>").appendTo(s);var x=0;for(var o=0;o<3;o++){var v=e("<tr></tr>").appendTo(y);for(var n=0;n<4;n++){e('<td class="calendar-menu-month"></td>').html(k.months[x++]).attr("abbr",x).appendTo(v)}}m.find(".calendar-menu-prev,.calendar-menu-next").hover(function(){e(this).addClass("calendar-menu-hover")},function(){e(this).removeClass("calendar-menu-hover")});m.find(".calendar-menu-next").bind("click",{target:r},function(i){var j=e(i.data.target).find(".calendar-menu-year");if(!isNaN(j.val())){j.val(parseInt(j.val())+1)}});m.find(".calendar-menu-prev").bind("click",{target:r},function(i){var j=e(i.data.target).find(".calendar-menu-year");if(!isNaN(j.val())){j.val(parseInt(j.val()-1))}});m.find(".calendar-menu-year").bind("keypress",{target:r},function(i){if(i.keyCode==13){w(i.data.target)}});m.find(".calendar-menu-month").hover(function(){e(this).addClass("calendar-menu-hover")},function(){e(this).removeClass("calendar-menu-hover")}).bind("click",{target:r},function(i){var j=e(i.data.target).find(".calendar-menu");j.find(".calendar-selected").removeClass("calendar-selected");e(this).addClass("calendar-selected");w(i.data.target)})}function w(B){var t=e.data(B,"calendar");var j=t.options;var C=e(B).find(".calendar-menu");var i=C.find(".calendar-menu-year").val();var A=C.find(".calendar-selected").attr("abbr");if(!isNaN(i)){j.year=parseInt(i);j.month=parseInt(A);a(B,t)}C.hide()}var q=m.find(".calendar-body");var z=m.find(".calendar-menu");var p=z.find(".calendar-menu-year-inner");var u=z.find(".calendar-menu-month-inner");p.find("input").val(k.year).focus();u.find("td.calendar-selected").removeClass("calendar-selected");u.find("td:eq("+(k.month-1)+")").addClass("calendar-selected");z._outerWidth(q.outerWidth());z._outerHeight(q.outerHeight());u._outerHeight(z.height()-p.outerHeight())}function b(s,u,t,o){if(!o){o=e.data(s,"calendar")}var l=o.options;var n=[];var w=new Date(u,t,0).getDate(),r;for(r=1;r<=w;r++){n.push([u,t,r])}var k=[],p=[],q,j,m;while(n.length>0){q=n.shift();p.push(q);var v=new Date(q[0],q[1]-1,q[2]).getDay();if(v==(l.firstDay==0?7:l.firstDay)-1){k.push(p);p=[]}}if(p.length){k.push(p)}var x=k[0];if(x.length<7){while(x.length<7){j=x[0];q=new Date(j[0],j[1]-1,j[2]-1);x.unshift([q.getFullYear(),q.getMonth()+1,q.getDate()])}}else{j=x[0];p=[];for(r=1;r<=7;r++){q=new Date(j[0],j[1]-1,j[2]-r);p.unshift([q.getFullYear(),q.getMonth()+1,q.getDate()])}k.unshift(p)}var y=k[k.length-1];while(y.length<7){m=y[y.length-1];q=new Date(m[0],m[1]-1,m[2]+1);y.push([q.getFullYear(),q.getMonth()+1,q.getDate()])}if(k.length<6){m=y[y.length-1];p=[];for(r=1;r<=7;r++){q=new Date(m[0],m[1]-1,m[2]+r);p.push([q.getFullYear(),q.getMonth()+1,q.getDate()])}k.push(p)}return k}function a(E,o){if(!o){o=e.data(E,"calendar")}var w=o.options;e(E).find(".calendar-title span").html(w.months[w.month-1]+" "+w.year);var q=e(E).find("div.calendar-body");q.find(">table").remove();var v=e('<table cellspacing="0" cellpadding="0" border="0"><thead></thead><tbody></tbody></table>').prependTo(q);var l=e("<tr></tr>").appendTo(v.find("thead")),B,C;for(B=w.firstDay,C=w.weeks.length;B<C;B++){l.append("<th>"+w.weeks[B]+"</th>")}for(B=0;B<w.firstDay;B++){l.append("<th>"+w.weeks[B]+"</th>")}var p=b(E,w.year,w.month,o);var k=v.find("tbody");for(B=0,C=p.length;B<C;B++){var y=p[B];l=e("<tr></tr>").appendTo(k);for(var z=0,u=y.length;z<u;z++){var A=y[z];e('<td class="calendar-day calendar-other-month"></td>').attr("abbr",A[0]+","+A[1]+","+A[2]).html(A[2]).appendTo(l)}}v.find('td[abbr^="'+w.year+","+w.month+'"]').removeClass("calendar-other-month");var m=new Date();var D=m.getFullYear()+","+(m.getMonth()+1)+","+m.getDate();v.find('td[abbr="'+D+'"]').addClass("calendar-today");if(w.current){v.find(".calendar-selected").removeClass("calendar-selected");var x=w.current.getFullYear()+","+(w.current.getMonth()+1)+","+w.current.getDate();v.find('td[abbr="'+x+'"]').addClass("calendar-selected")}var s=6-w.firstDay;var r=s+1;if(s>=7){s-=7}if(r>=7){r-=7}var n=v.find("tr");n.find("td:eq("+s+")").addClass("calendar-saturday");n.find("td:eq("+r+")").addClass("calendar-sunday");v.find("td").hover(function(){e(this).addClass("calendar-hover")},function(){e(this).removeClass("calendar-hover")}).bind("click",{target:E,table:v[0]},function(G){var j=e.data(G.data.target,"calendar");var i=j.options,F=e(this);e(G.data.table).find(".calendar-selected").removeClass("calendar-selected");F.addClass("calendar-selected");var t=F.attr("abbr").split(",");i.current=new Date(t[0],parseInt(t[1])-1,t[2]);i.onSelect.call(G.data.target,i.current)})}e.fn.calendar=function(i,j){if(typeof i=="string"){return e.fn.calendar.methods[i](this,j)}i=i||{};return this.each(function(k){var l=e.data(this,"calendar"),m=e(this);if(l){e.extend(l.options,k)}else{l=e.data(this,"calendar",{options:e.extend({},e.fn.calendar.defaults,e.fn.calendar.parseOptions(this),k)});f(this)}if(l.options.border==false){m.addClass("calendar-noborder")}g(this,l);a(this,l);m.find("div.calendar-menu").hide()},[i])};e.fn.calendar.methods={options:function(i){return e.data(i[0],"calendar").options},resize:function(i){return i.each(function(){g(this)})},moveTo:function(j,i){return j.each(function(){e(this).calendar({year:i.getFullYear(),month:i.getMonth()+1,current:i})})}};e.fn.calendar.parseOptions=function(i){return e.extend({},e.parser.parseOptions(i,["width","height",{firstDay:"number",fit:"boolean",border:"boolean"}]))};e.fn.calendar.defaults={width:180,height:180,fit:false,border:true,firstDay:0,weeks:["S","M","T","W","T","F","S"],months:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],year:new Date().getFullYear(),month:new Date().getMonth()+1,current:new Date(),onSelect:function(i){}}})(jQuery);