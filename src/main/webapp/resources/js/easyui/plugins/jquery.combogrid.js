(function($){function e(n,h){var m=$.data(n,"combogrid");var l=m.options;var k=m.grid;var j=$(n);if(!k){k=$('<table comboid="'+j.attr("id")+'"></table>').appendTo(h);m.grid=k}k.datagrid($.extend({},l,{border:false,fit:true,singleSelect:(!l.multiple),onLoadSuccess:function(s){var t=$("#"+$(this).attr("comboid"))[0];var r=$.data(t,"combogrid");if(r.donotFired){return}var q=r.options;var p=r.remainText;var o=$(t).combo("getValues");b(t,o,p,r);q.onLoadSuccess.apply(t,arguments)},onClickRow:function(p,t){var s=$("#"+$(this).attr("comboid"))[0];var r=$.data(s,"combogrid");if(r.donotFired){return}var q=r.options;r.remainText=false;i(s,r);var o=$(s);if(!q.multiple){o.combo("hidePanel")}o.combo("textbox").focus().select();q.onClickRow.call(this,p,t)},onSelect:function(o,s){var r=$("#"+$(this).attr("comboid"))[0];var q=$.data(r,"combogrid");if(q.donotFired){return}var p=q.options;i(r,q);p.onSelect.call(this,o,s)},onUnselect:function(o,s){var r=$("#"+$(this).attr("comboid"))[0];var q=$.data(r,"combogrid");if(q.donotFired){return}var p=q.options;i(r,q);p.onUnselect.call(this,o,s)},onSelectAll:function(q){var r=$("#"+$(this).attr("comboid"))[0];var p=$.data(r,"combogrid");if(p.donotFired){return}var o=p.options;i(r,p);o.onSelectAll.call(this,q)},onUnselectAll:function(q){var r=$("#"+$(this).attr("comboid"))[0];var p=$.data(r,"combogrid");if(p.donotFired){return}var o=p.options;if(o.multiple){i(r,p)}o.onUnselectAll.call(this,q)}}));function i(A,q){if(!q){q=$.data(A,"combogrid")}var p=q.grid;var C=$(A);var y=q.remainText;var E=p.datagrid("getSelections");var B=[],F=[];if(l.multiple&&l.canSearch&&C.combo("getText")!=""){var x={},o={},s=p.datagrid("getData").rows,u=C.combo("getValues"),v=C.combo("getText").split(l.separator);for(var w=0;w<E.length;w++){x[E[w][l.idField]]=E[w]}for(var w=0;w<s.length;w++){if(!x[s[w][l.idField]]){o[s[w][l.idField]]=s[w]}}for(var w=0;w<u.length;w++){if(x[u[w]]){B.push(u[w]);F.push(x[u[w]][l.textField]);x[u[w]]=false}else{if(!o[u[w]]){B.push(u[w]);F.push(v[w])}}}for(var r in x){if(x[r]){B.push(r);F.push(x[r][l.textField])}}}else{for(var w=0,z=E.length;w<z;w++){var D=E[w];B.push(D[l.idField]);F.push(D[l.textField])}}if(!y){C.combo("setText",F.join(l.separator))}if(!l.multiple){C.combo("setValues",(B.length?B:[""]))}else{C.combo("setValues",B)}}}function d(k,j){if(!j){j=$.data(k,"combogrid")}var i=j.options;var h=$(k);if(!h.attr("id")){h.attr("id",$.parser.getObjGUID())}h.addClass("combogrid-f");i.afterPanelInited=e;h.combo(i)}function a(o,m,n){if(!n){n=$.data(o,"combogrid")}var l=n.options;if(!n.grid){$(o).combo("panel")}var j=n.grid;var h=j.datagrid("getRows").length;n.remainText=false;var i;var k=j.datagrid("getSelections");if(k.length){i=j.datagrid("getRowIndex",k[k.length-1][l.idField]);i+=m;if(i<0){i=0}if(i>=h){i=h-1}}else{if(m>0){i=0}else{if(m<0){i=h-1}else{i=-1}}}if(i>=0){j.datagrid("clearSelections");j.datagrid("selectRow",i);if(m==0){l.onClickRow.call(this,i,j.datagrid("getRowByIndex",i))}}}function c(o,l){var n=$.data(o,"combogrid");if(!n.grid){$(o).combo("panel")}var j=n.grid;var k=j.datagrid("options");if(!k.pagination){return}var h=k.pageNumber;var i;if(l<0&&h>1){i=j.datagrid("getPager");i.pagination("select",h-1)}else{if(l>0){i=j.datagrid("getPager");var m=i.pagination("getPageCount");if(h<m){i.pagination("select",h+1)}}}}function b(p,s,m,k){if(!k){k=$.data(p,"combogrid")}var u=$(p);var h=k.options;var j=k.grid;if(!j){if(u.combo("getValues").join(",")==s.join(",")){return}u.combo("setValues",s)}else{var w=j.datagrid("getRows");var v=[];k.donotFired=true;j.datagrid("clearSelections");for(var l=0,o=s.length;l<o;l++){var r=s[l];if(r==""){continue}var n=j.datagrid("getRowIndex",r);if(n>=0){j.datagrid("selectRow",n);v.push(w[n][h.textField])}else{var q=u.combo("getText");v.push(q.split(h.separator)[l])}}k.donotFired=false;if(!m){u.combo("setText",v.join(h.separator))}if(u.combo("getValues").join(",")==s.join(",")){return}u.combo("setValues",s)}if(h.onAfterChange){h.onAfterChange.call(p)}}function g(p,o,n){if(!n){n=$.data(p,"combogrid")}var l=n.options;if(!n.grid){$(p).combo("panel")}var k=n.grid;n.remainText=true;try{if(l.onQuery){l.onQuery.call(p,o)}else{if(l.mode=="remote"){k.datagrid("clearSelections");k.datagrid("load",$.extend({},l.queryParams,{q:o}))}else{if(!o){return}var m=k.datagrid("getRows");for(var j=0,h=m.length;j<h;j++){if(l.filter.call(p,o,m[j],l)){k.datagrid("clearSelections");k.datagrid("selectRow",j);return}}}}}finally{}}function f(j){var i=$.data(j,"combogrid");var h=i.grid;if(h){return h}$(j).combo("panel");return i.grid}$.fn.combogrid=function(h,i){if(typeof h=="string"){var j=$.fn.combogrid.methods[h];if(j){return j(this,i)}else{return $.fn.combo.methods[h](this,i)}}h=h||{};return this.each(function(k){var l=$.data(this,"combogrid");if(l){$.extend(l.options,k)}else{l=$.data(this,"combogrid",{options:$.extend({},$.fn.combogrid.defaults,$.fn.combogrid.parseOptions(this),k)})}d(this,l)},[h])};$.fn.combogrid.methods={options:function(h){return $.data(h[0],"combogrid").options},grid:function(h){return f(h[0])},setValues:function(i,h){return i.each(function(){b(this,h)})},setValue:function(i,h){return i.each(function(){b(this,[h])})},clear:function(h){return h.each(function(){var j=$.data(this,"combogrid");var i=j.grid;if(i){i.datagrid("clearSelections")}$(this).combo("clear")})}};$.fn.combogrid.parseOptions=function(h){return $.extend({},$.fn.combo.parseOptions(h),$.fn.datagrid.parseOptions(h),$.parser.parseOptions(h,["idField","textField","mode"]))};$.fn.combogrid.defaults=$.extend({},$.fn.combo.defaults,$.fn.datagrid.defaults,{loadMsg:null,idField:null,textField:null,mode:"local",keyHandler:{up:function(){a(this,-1)},down:function(){a(this,1)},enter:function(){a(this,0);$(this).combo("hidePanel")},ctrlLeft:function(){c(this,-1)},ctrlRight:function(){c(this,1)}},doQuery:function(h){g(this,h)},filter:function(i,j,h){if(!h){h=$(this).combogrid("options")}return j[h.textField].indexOf(i)==0}})})(jQuery);