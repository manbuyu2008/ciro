(function(h){function k(C,B){if(!B){B=h.data(C,"treegrid")}var A=B.options;h(C).datagrid(h.extend({},A,{url:null,loader:function(){return false},onLoadSuccess:function(){},onResizeColumn:function(G,D){var F=h.data(this,"treegrid");var E=F.options;x(this);E.onResizeColumn.call(this,G,D)},doSortColumn:function(E,D){var H=h.data(this,"treegrid");var F=H.options;F.sortName=E;F.sortOrder=D;if(F.remoteSort){f(this)}else{var G=h(this).treegrid("getData");b(this,0,G)}F.onSortColumn.call(this,E,D)},onBeforeEdit:function(D,G){var F=h.data(this,"treegrid");var E=F.options;if(E.onBeforeEdit.call(this,G)==false){return false}},onAfterEdit:function(D,H,E){var G=h.data(this,"treegrid");var F=G.options;F.onAfterEdit.call(this,H,E)},onCancelEdit:function(D,G){var F=h.data(this,"treegrid");var E=F.options;E.onCancelEdit.call(this,G)},onSelect:function(D){var F=h.data(this,"treegrid");var E=F.options;E.onSelect.call(this,o(this,D))},onUnselect:function(D){var F=h.data(this,"treegrid");var E=F.options;E.onUnselect.call(this,o(this,D))},onSelectAll:function(){var E=h.data(this,"treegrid");var D=E.options;D.onSelectAll.call(this,E.data)},onUnselectAll:function(){var E=h.data(this,"treegrid");var D=E.options;D.onUnselectAll.call(this,E.data)},onCheck:function(D){var F=h.data(this,"treegrid");var E=F.options;E.onCheck.call(this,o(this,D))},onUncheck:function(D){var F=h.data(this,"treegrid");var E=F.options;E.onUncheck.call(this,o(this,D))},onCheckAll:function(){var E=h.data(this,"treegrid");var D=E.options;D.onCheckAll.call(this,E.data)},onUncheckAll:function(){var E=h.data(this,"treegrid");var D=E.options;D.onUncheckAll.call(this,E.data)},onClickRow:function(D){var F=h.data(this,"treegrid");var E=F.options;E.onClickRow.call(this,o(this,D))},onDblClickRow:function(D){var F=h.data(this,"treegrid");var E=F.options;E.onDblClickRow.call(this,o(this,D))},onClickCell:function(D,G){var F=h.data(this,"treegrid");var E=F.options;E.onClickCell.call(this,G,o(this,D))},onDblClickCell:function(D,G){var F=h.data(this,"treegrid");var E=F.options;E.onDblClickCell.call(this,G,o(this,D))},onRowContextMenu:function(G,D){var F=h.data(this,"treegrid");var E=F.options;E.onContextMenu.call(this,G,o(this,D))}}));if(A.pagination){var z=h(C).datagrid("getPager");z.pagination({pageNumber:A.pageNumber,pageSize:A.pageSize,pageList:A.pageList,onSelectPage:function(G,D){var H=h("#"+h(this).attr("parentId"))[0];var F=h.data(H,"treegrid");var E=F.options;E.pageNumber=G;E.pageSize=D;f(H)}});A.pageSize=z.pagination("options").pageSize}}function x(E,B,G){if(!G){G=h.data(E,"datagrid")}var z=G.options;var H=G.dc;if(!H.body1.is(":empty")&&(!z.nowrap||z.autoRowHeight)){if(B!=undefined){var A=e(E,B);for(var C=0,D=A.length;C<D;C++){F(A[C][z.idField],E,z)}}}h(E).datagrid("fixRowHeight",B);function F(K,M,L){var J=L.finder.getTr(M,K,"body",1);var N=L.finder.getTr(M,K,"body",2);J.css("height","");N.css("height","");var I=Math.max(J.height(),N.height());J.css("height",I);N.css("height",I)}}function v(D,A,C){if(!A){A=h.data(D,"datagrid")}var z=A.dc;if(!C){C=h.data(D,"treegrid")}var B=C.options;if(!B.rownumbers){return}z.body1.find("div.datagrid-cell-rownumber").each(function(E){h(this).html(E+1)})}function d(B,A){if(!A){A=h.data(B,"datagrid")}var z=A.dc;A.clickHandler=h._data(z.body1.add(z.body2)[0],"events").click[0].handler;z.body1.add(z.body2).bind("mouseover",function(E){var C=h(E.target);var D=C.closest("tr.datagrid-row");if(!D.length){return}if(C.hasClass("tree-hit")){C.hasClass("tree-expanded")?C.addClass("tree-expanded-hover"):C.addClass("tree-collapsed-hover")}E.stopPropagation()}).bind("mouseout",function(E){var C=h(E.target);var D=C.closest("tr.datagrid-row");if(!D.length){return}if(C.hasClass("tree-hit")){C.hasClass("tree-expanded")?C.removeClass("tree-expanded-hover"):C.removeClass("tree-collapsed-hover")}E.stopPropagation()}).unbind("click").bind("click",{target:B},function(F){var D=h(F.target);var E=D.closest("tr.datagrid-row");if(!E.length){return}if(D.hasClass("tree-hit")){q(F.data.target,E.attr("node-id"))}else{var C=h.data(F.data.target,"datagrid");C.clickHandler(F)}F.stopPropagation()})}function t(F,E,A){if(!A){A=h.data(F,"treegrid")}var z=A.options;var D=z.finder.getTr(F,E,"body",1);var C=z.finder.getTr(F,E,"body",2);var B=h(F);var I=B.datagrid("getColumnFields",true).length+(z.rownumbers?1:0);var H=B.datagrid("getColumnFields",false).length;G(D,I);G(C,H);function G(J,K){h('<tr class="treegrid-tr-tree"><td style="border:0px" colspan="'+K+'"><div></div></td></tr>').insertAfter(J)}}function b(P,K,Q,M,N,B){if(!B){B=h.data(P,"treegrid")}if(!N){N=h.data(P,"datagrid")}var H=B.options;var O=N.dc;Q=H.loadFilter.call(P,Q,K);var E=N.panel;var G=E.children("div.datagrid-view");var L=G.children("div.datagrid-view1");var J=G.children("div.datagrid-view2");var I=o(P,K),D,C;if(I){var A=H.finder.getTr(P,K,"body",1);var z=H.finder.getTr(P,K,"body",2);D=A.next("tr.treegrid-tr-tree").children("td").children("div");C=z.next("tr.treegrid-tr-tree").children("td").children("div")}else{D=O.body1;C=O.body2}if(!M){B.data=[];D.add(C).children(".datagrid-btable,.datagrid-emptybody").remove()}if(H.view.onBeforeRender){H.view.onBeforeRender.call(H.view,P,K,Q)}H.view.render.call(H.view,P,D,true);H.view.render.call(H.view,P,C,false);if(H.showFooter){H.view.renderFooter.call(H.view,P,O.footer1,true);H.view.renderFooter.call(H.view,P,O.footer2,false)}if(H.view.onAfterRender){H.view.onAfterRender.call(H.view,P)}H.onLoadSuccess.call(P,I,Q);if(!K&&H.pagination){var R=B.total;var F=h(P).datagrid("getPager");if(F.pagination("options").total!=R){F.pagination({total:R})}}x(P,undefined,N);v(P,N,B);h(P).treegrid("autoSizeColumn")}function f(J,H,G,C,K,A){if(!A){A=h.data(J,"treegrid")}var z=A.options;var D=h(J);var I=D.datagrid("getPanel").find("div.datagrid-body");if(G){z.queryParams=G}var E=h.extend({},z.queryParams);if(z.pagination){h.extend(E,{page:z.pageNumber,rows:z.pageSize})}if(z.sortName){h.extend(E,{sort:z.sortName,order:z.sortOrder})}var M=o(J,H);if(z.onBeforeLoad.call(J,M,E)==false){return}var B=I.find("tr[node-id="+H+"] span.tree-folder");B.addClass("tree-loading");D.treegrid("loading");var F=D.attr("id");var L=z.loader.call(J,E,function(O){var N=h("#"+F),P=N[0];B.removeClass("tree-loading");N.treegrid("loaded");b(P,H,O,C);if(K){K()}},function(){var N=h("#"+F),O=N[0];B.removeClass("tree-loading");h(O).treegrid("loaded");z.onLoadError.apply(O,arguments);if(K){K()}});if(L==false){B.removeClass("tree-loading");D.treegrid("loaded")}}function g(A){var z=s(A);if(z.length){return z[0]}else{return null}}function s(A,z){if(!z){z=h.data(A,"treegrid")}return z.data}function j(A,z){var B=o(A,z);if(B._parentId){return o(A,B._parentId)}else{return null}}function e(G,D,A){if(!A){A=h.data(G,"treegrid")}var z=A.options;var E=h(G).datagrid("getPanel").find("div.datagrid-view2 div.datagrid-body");var B=[];if(D){H(D,G,z,B)}else{var I=s(G);for(var C=0,F=I.length;C<F;C++){B.push(I[C]);H(I[C][z.idField],G,z,B)}}function H(Q,P,N,K){var O=o(P,Q);if(O&&O.children){for(var L=0,J=O.children.length;L<J;L++){var M=O.children[L];K.push(M);H(M[N.idField],P,N,K)}}}return B}function n(A){var z=l(A);if(z.length){return z[0]}else{return null}}function l(B){var A=[];var z=h(B).datagrid("getPanel");z.find("div.datagrid-view2 div.datagrid-body tr.datagrid-row-selected").each(function(C){var D=h(this).attr("node-id");A.push(o(C,D))},[B]);return A}function m(E,A,D){if(!D){D=h.data(E,"treegrid")}if(!A){return 0}var C=D.options;var z=h(E).datagrid("getPanel").children("div.datagrid-view");var B=z.find("div.datagrid-body tr[node-id="+A+"]").children("td[field="+C.treeField+"]");return B.find("span.tree-indent,span.tree-hit").length}function o(H,B,A){if(!A){A=h.data(H,"treegrid")}var z=A.options;var E=A.data;var D=[E];while(D.length){var I=D.shift();for(var F=0,G=I.length;F<G;F++){var C=I[F];if(C[z.idField]==B){return C}else{if(C.children){D.push(C.children)}}}}return null}function c(G,D,B){if(!B){B=h.data(G,"treegrid")}var A=B.options;var I=o(G,D);var H=A.finder.getTr(G,D);var z=H.find("span.tree-hit");if(z.length==0){return}if(z.hasClass("tree-collapsed")){return}if(A.onBeforeCollapse.call(G,I)==false){return}z.removeClass("tree-expanded tree-expanded-hover").addClass("tree-collapsed");z.next().removeClass("tree-folder-open");I.state="closed";H=H.next("tr.treegrid-tr-tree");var E=H.children("td").children("div");var C=h(G);if(A.animate){var F=C.attr("id");E.slideUp("normal",function(){var J=h("#"+F),K=J[0];J.treegrid("autoSizeColumn");x(K,D);A.onCollapse.call(K,I)})}else{E.hide();C.treegrid("autoSizeColumn");x(G,D);A.onCollapse.call(G,I)}}function a(F,C,B){if(!B){B=h.data(F,"treegrid")}var A=B.options;var G=A.finder.getTr(F,C);var z=G.find("span.tree-hit");var I=o(F,C);if(z.length==0){return}if(z.hasClass("tree-expanded")){return}if(A.onBeforeExpand.call(F,I)==false){return}z.removeClass("tree-collapsed tree-collapsed-hover").addClass("tree-expanded");z.next().addClass("tree-folder-open");var H=G.next("tr.treegrid-tr-tree"),D;if(H.length){D=H.children("td").children("div");E(D)}else{t(F,I[A.idField]);H=G.next("tr.treegrid-tr-tree");D=H.children("td").children("div");D.hide();f(F,I[A.idField],{id:I[A.idField]},true,function(){if(D.is(":empty")){H.remove()}else{E(D)}H=null;D=null;A=null})}function E(J){I.state="open";if(A.animate){J.slideDown("normal",function(){h(F).treegrid("autoSizeColumn");x(F,C);A.onExpand.call(F,I)})}else{J.show();h(F).treegrid("autoSizeColumn");x(F,C);A.onExpand.call(F,I)}}}function q(E,z,D){if(!D){D=h.data(E,"treegrid")}var A=D.options;var C=A.finder.getTr(E,z);var B=C.find("span.tree-hit");if(B.hasClass("tree-expanded")){c(E,z)}else{a(E,z)}}function u(F,B,E){if(!E){E=h.data(F,"treegrid")}var D=E.options;var A=e(F,B);if(B){A.unshift(o(F,B))}for(var C=0,z=A.length;C<z;C++){c(F,A[C][D.idField])}}function i(F,B,E){if(!E){E=h.data(F,"treegrid")}var D=E.options;var A=e(F,B);if(B){A.unshift(o(F,B))}for(var C=0,z=A.length;C<z;C++){a(F,A[C][D.idField])}}function r(H,E,B){if(!B){B=h.data(H,"treegrid")}var z=B.options;var A=[];var D=j(H,E);while(D){var C=D[z.idField];A.unshift(C);D=j(H,C)}for(var F=0,G=A.length;F<G;F++){a(H,A[F])}}function w(F,C,B){if(!B){B=h.data(F,"treegrid")}var A=B.options;if(C.parent){var E=h(F).datagrid("getPanel").find("div.datagrid-body");var G=E.find("tr[node-id="+C.parent+"]");if(G.next("tr.treegrid-tr-tree").length==0){t(F,C.parent)}var H=G.children("td[field="+A.treeField+"]").children("div.datagrid-cell");var D=H.children("span.tree-icon");if(D.hasClass("tree-file")){D.removeClass("tree-file").addClass("tree-folder");var z=h('<span class="tree-hit tree-expanded"></span>').insertBefore(D);if(z.prev().length){z.prev().remove()}}}b(F,C.parent,C.data,true)}function y(G,B,F){if(!F){F=h.data(G,"treegrid")}var C=F.options;var E=C.finder.getTr(G,B);E.next("tr.treegrid-tr-tree").remove();E.remove();var D=A(B,G);if(D){if(D.children.length==0){E=C.finder.getTr(G,D[C.idField]);E.next("tr.treegrid-tr-tree").remove();var z=E.children("td[field="+C.treeField+"]").children("div.datagrid-cell");z.find(".tree-icon").removeClass("tree-folder").addClass("tree-file");z.find(".tree-hit").remove();h('<span class="tree-indent"></span>').prependTo(z)}}v(G);function A(M,K){var L;var J=j(K,B);if(J){L=J.children}else{L=h(K).treegrid("getData")}for(var I=0,H=L.length;I<H;I++){if(L[I][C.idField]==M){L.splice(I,1);break}}return J}}h.fn.treegrid=function(z,A){if(typeof z=="string"){var B=h.fn.treegrid.methods[z];if(B){return B(this,A)}else{return this.datagrid(z,A)}}z=z||{};return this.each(function(){var C=h.data(this,"treegrid");if(C){h.extend(C.options,z)}else{C=h.data(this,"treegrid",{options:h.extend({},h.fn.treegrid.defaults,h.fn.treegrid.parseOptions(this),z),data:[]})}k(this,C);f(this);d(this)})};h.fn.treegrid.methods={options:function(z){return h.data(z[0],"treegrid").options},resize:function(A,z){return A.each(function(){h(this).datagrid("resize",z)})},fixRowHeight:function(A,z){return A.each(function(){x(this,z)})},loadData:function(A,z){return A.each(function(){b(this,null,z)})},reload:function(A,z){return A.each(function(){if(z){var C=h(this).treegrid("find",z);if(C.children){C.children.splice(0,C.children.length)}var B=h(this).datagrid("getPanel").find("div.datagrid-body");var E=B.find("tr[node-id="+z+"]");E.next("tr.treegrid-tr-tree").remove();var D=E.find("span.tree-hit");D.removeClass("tree-expanded tree-expanded-hover").addClass("tree-collapsed");a(this,z)}else{f(this,null,{})}})},reloadFooter:function(A,z){return A.each(function(){var D=h.data(this,"treegrid");var C=D.options;var B=h.data(this,"datagrid").dc;if(z){D.footer=z}if(C.showFooter){C.view.renderFooter.call(C.view,this,B.footer1,true);C.view.renderFooter.call(C.view,this,B.footer2,false);if(C.view.onAfterRender){C.view.onAfterRender.call(C.view,this)}h(this).treegrid("fixRowHeight")}})},loading:function(z){return z.each(function(){h(this).datagrid("loading")})},loaded:function(z){return z.each(function(){h(this).datagrid("loaded")})},getData:function(z){return h.data(z[0],"treegrid").data},getFooterRows:function(z){return h.data(z[0],"treegrid").footer},getRoot:function(z){return g(z[0])},getRoots:function(z){return s(z[0])},getParent:function(A,z){return j(A[0],z)},getChildren:function(A,z){return e(A[0],z)},getSelected:function(z){return n(z[0])},getSelections:function(z){return l(z[0])},getLevel:function(A,z){return m(A[0],z)},find:function(A,z){return o(A[0],z)},isLeaf:function(D,C){var z=h.data(D[0],"treegrid").options;var B=z.finder.getTr(D[0],C);var A=B.find("span.tree-hit");return A.length==0},select:function(A,z){return A.each(function(){h(this).datagrid("selectRow",z)})},unselect:function(A,z){return A.each(function(){h(this).datagrid("unselectRow",z)})},collapse:function(A,z){return A.each(function(){c(this,z)})},expand:function(A,z){return A.each(function(){a(this,z)})},toggle:function(A,z){return A.each(function(){q(this,z)})},collapseAll:function(A,z){return A.each(function(){u(this,z)})},expandAll:function(A,z){return A.each(function(){i(this,z)})},expandTo:function(A,z){return A.each(function(){r(this,z)})},append:function(A,z){return A.each(function(){w(this,z)})},remove:function(A,z){return A.each(function(){y(this,z)})},refresh:function(A,z){return A.each(function(){var B=h.data(this,"treegrid").options;B.view.refreshRow.call(B.view,this,z)})},beginEdit:function(A,z){return A.each(function(){h(this).datagrid("beginEdit",z);h(this).treegrid("fixRowHeight",z)})},endEdit:function(z){return z.each(function(){h(this).datagrid("endEdit")})},cancelEdit:function(z){return z.each(function(){h(this).datagrid("cancelEdit")})}};h.fn.treegrid.parseOptions=function(z){return h.extend({},h.fn.datagrid.parseOptions(z),h.parser.parseOptions(z,["treeField",{animate:"boolean"}]))};var p=h.extend({},h.fn.datagrid.defaults.view,{render:function(E,B,z){var A=h.data(E,"treegrid").options;var D=h(E).datagrid("getColumnFields",z);var G=h.data(E,"datagrid").rowIdPrefix;if(z){if(!(A.rownumbers||(A.frozenColumns&&A.frozenColumns.length))){return}}var F=this;var H=C(E,z,this.treeLevel,this.treeNodes);h(B).append(H.join(""));function C(P,I,M,K){var R=['<table class="datagrid-btable" cellspacing="0" cellpadding="0" border="0"><tbody>'];for(var N=0;N<K.length;N++){var S=K[N];if(S.state!="open"&&S.state!="closed"){S.state="open"}var T=A.rowStyler?A.rowStyler.call(P,S):"";var J=T?'style="'+T+'"':"";var L=G+"-"+(I?1:2)+"-"+S[A.idField];R.push('<tr id="'+L+'" class="datagrid-row" node-id='+S[A.idField]+" "+J+">");R=R.concat(F.renderRow.call(F,P,D,I,M,S));R.push("</tr>");if(S.children&&S.children.length){var O=C(P,I,M+1,S.children);var Q=S.state=="closed"?"none":"block";R.push('<tr class="treegrid-tr-tree"><td style="border:0px" colspan='+(D.length+(A.rownumbers?1:0))+'><div style="display:'+Q+'">');R=R.concat(O);R.push("</div></td></tr>")}}R.push("</tbody></table>");return R}},renderEditor:function(D,A,C){if(A.length==0){return}var z=h(D).datagrid("getColumnFields",C);var B=['<table class="datagrid-etable" cellspacing="0" cellpadding="0" border="0"><tbody>'];B.push('<tr class="datagrid-row datagrid-row-editing" node-id="">');B.push(this.renderRow.call(this,D,z,C,0,{}));B.push("</tr></tbody></table>");h(B.join("")).appendTo(A)},attrRowIndex:function(A,z){A.attr("node-id",z)},acceptChanges:function(z){h(z).treegrid("endEdit")},rejectChanges:function(z){h(z).treegrid("cancelEdit")},renderFooter:function(G,C,z){var B=h.data(G,"treegrid");var A=B.options;var J=B.footer||[];var E=h(G).datagrid("getColumnFields",z);var H=['<table class="datagrid-ftable" cellspacing="0" cellpadding="0" border="0"><tbody>'];for(var D=0,F=J.length;D<F;D++){var I=J[D];I[A.idField]=I[A.idField]||("foot-row-id"+D);H.push('<tr class="datagrid-row" node-id='+I[A.idField]+">");H.push(this.renderRow.call(this,G,E,z,0,I));H.push("</tr>")}H.push("</tbody></table>");h(C).html(H.join(""))},renderRow:function(J,I,z,G,M){var A=h.data(J,"treegrid").options;var E=[];if(z&&A.rownumbers){E.push('<td class="datagrid-td-rownumber"><div class="datagrid-cell-rownumber">0</div></td>')}for(var H=0;H<I.length;H++){var K=I[H];var D=h(J).datagrid("getColumnOption",K);if(D){var L=D.styler?(D.styler(M[K],M)||""):"";var B=D.hidden?'style="display:none;'+L+'"':(L?'style="'+L+'"':"");E.push('<td field="'+K+'" '+B+">");if(D.checkbox){B=""}else{B="";B+="text-align:"+(D.align||"left")+";";if(!A.nowrap){B+="white-space:normal;height:auto;"}else{if(A.autoRowHeight){B+="height:auto;"}}}E.push('<div style="'+B+'" ');if(D.checkbox){E.push('class="datagrid-cell-check ')}else{E.push('class="datagrid-cell '+D.cellClass)}E.push('">');if(D.checkbox){if(M.checked){E.push('<input type="checkbox" checked="checked"')}else{E.push('<input type="checkbox"')}E.push(' name="'+K+'" value="'+(M[K]!=undefined?M[K]:"")+'"/>')}else{var C=null;if(D.formatter){C=D.formatter(M[K],M)}else{C=M[K]}if(K==A.treeField){for(var F=0;F<G;F++){E.push('<span class="tree-indent"></span>')}if(M.state=="closed"){E.push('<span class="tree-hit tree-collapsed"></span>');E.push('<span class="tree-icon tree-folder '+(M.iconCls?M.iconCls:"")+'"></span>')}else{if(M.children&&M.children.length){E.push('<span class="tree-hit tree-expanded"></span>');E.push('<span class="tree-icon tree-folder tree-folder-open '+(M.iconCls?M.iconCls:"")+'"></span>')}else{E.push('<span class="tree-indent"></span>');E.push('<span class="tree-icon tree-file '+(M.iconCls?M.iconCls:"")+'"></span>')}}E.push('<span class="tree-title">'+C+"</span>")}else{E.push(C)}}E.push("</div>");E.push("</td>")}}return E.join("")},refreshRow:function(D,F){var E=h(D).treegrid("find",F);var B=h.data(D,"treegrid").options;var z=B.rowStyler?B.rowStyler.call(D,E):"";var A=z?z:"";var C=B.finder.getTr(D,F);C.attr("style",A);C.children("td").each(function(){var G=h(this).find("div.datagrid-cell");var M=h(this).attr("field");var J=h(D).datagrid("getColumnOption",M);if(J){var I=J.styler?(J.styler(E[M],E)||""):"";var L=J.hidden?"display:none;"+I:(I?I:"");h(this).attr("style",L);var N=null;if(J.formatter){N=J.formatter(E[M],E)}else{N=E[M]}if(M==B.treeField){G.children("span.tree-title").html(N);var H="tree-icon";var K=G.children("span.tree-icon");if(K.hasClass("tree-folder")){H+=" tree-folder"}if(K.hasClass("tree-folder-open")){H+=" tree-folder-open"}if(K.hasClass("tree-file")){H+=" tree-file"}if(E.iconCls){H+=" "+E.iconCls}K.attr("class",H)}else{G.html(N)}}});h(D).treegrid("fixRowHeight",F)},onBeforeRender:function(E,F,D){if(!D){return false}var C=h.data(E,"treegrid");var B=C.options;if(D.length==undefined){if(D.footer){C.footer=D.footer}if(D.total){C.total=D.total}D=this.transfer(E,F,D.rows)}else{function A(I,K){for(var H=0,G=I.length;H<G;H++){var J=I[H];J._parentId=K;if(J.children&&J.children.length){A(J.children,J[B.idField])}}}A(D,F)}var z=o(E,F);if(z){if(z.children){z.children=z.children.concat(D)}else{z.children=D}}else{C.data=C.data.concat(D)}if(!B.remoteSort){this.sort(E,D)}this.treeNodes=D;this.treeLevel=h(E).treegrid("getLevel",F)},sort:function(D,C){var B=h.data(D,"treegrid").options;var A=h(D).treegrid("getColumnOption",B.sortName);if(A){var E=A.sorter||function(G,F){return(G>F?1:-1)};z(C,B)}function z(J,I){J.sort(function(L,K){return E(L[I.sortName],K[I.sortName])*(I.sortOrder=="asc"?1:-1)});for(var H=0,F=J.length;H<F;H++){var G=J[H].children;if(G&&G.length){z(G,I)}}}},transfer:function(H,F,D){var z=h.data(H,"treegrid").options;var J=[],E,G;for(E=0,G=D.length;E<G;E++){J.push(D[E])}var A=[],I;for(E=0,G=J.length;E<G;E++){I=J[E];if(!F){if(!I._parentId){A.push(I);removeArrayItem(J,I);G--;E--}}else{if(I._parentId==F){A.push(I);removeArrayItem(J,I);G--;E--}}}var C=[];for(E=0,G=A.length;E<G;E++){C.push(A[E])}while(C.length){var B=C.shift();for(E=0,G=J.length;E<G;E++){I=J[E];if(I._parentId==B[z.idField]){if(B.children){B.children.push(I)}else{B.children=[I]}C.push(I);removeArrayItem(J,I);E--;G--}}}return A}});h.fn.treegrid.defaults=h.extend({},h.fn.datagrid.defaults,{treeField:null,animate:false,singleSelect:true,view:p,loader:function(C,B,z){var A=h(this).treegrid("options");if(!A.url){return false}h.ajax({type:A.method,url:A.url,data:C,dataType:"json",success:function(D){B(D)},error:function(){z.apply(this,arguments)}})},loadFilter:function(z,A){return z},finder:{getTr:function(E,A,G,B){G=G||"body";B=B||0;var H=h.data(E,"datagrid").dc;if(B==0){var z=h.data(E,"treegrid").options;var D=z.finder.getTr(E,A,G,1);var C=z.finder.getTr(E,A,G,2);return D.add(C)}else{if(G=="body"){var F=h("#"+h.data(E,"datagrid").rowIdPrefix+"-"+B+"-"+A);if(!F.length){F=(B==1?H.body1:H.body2).find("tr[node-id="+A+"]")}return F}else{if(G=="footer"){return(B==1?H.footer1:H.footer2).find("tr[node-id="+A+"]")}else{if(G=="selected"){return(B==1?H.body1:H.body2).find("tr.datagrid-row-selected")}else{if(G=="last"){return(B==1?H.body1:H.body2).find("tr:last[node-id]")}else{if(G=="allbody"){return(B==1?H.body1:H.body2).find("tr[node-id]")}else{if(G=="allfooter"){return(B==1?H.footer1:H.footer2).find("tr[node-id]")}else{if(G=="editor"){return(B==1?H.editor1:H.editor2).find(">table>tbody>tr[node-id]")}}}}}}}}},getRow:function(z,A){return h(z).treegrid("find",A)}},onBeforeLoad:function(A,z){},onLoadSuccess:function(A,z){},onLoadError:function(){},onBeforeCollapse:function(z){},onCollapse:function(z){},onBeforeExpand:function(z){},onExpand:function(z){},onClickRow:function(z){},onDblClickRow:function(z){},onClickCell:function(z,A){},onDblClickCell:function(z,A){},onContextMenu:function(z,A){},onBeforeEdit:function(z){},onAfterEdit:function(A,z){},onCancelEdit:function(z){}})})(jQuery);